## 实验3-薛钦亮组

#### <p align="right">刘佳伟</p>

### 实验分工安排

刘佳伟：主要编写程序

薛钦亮：组长

郭云达：测试

黄伟琛：对接整合

### 实验环境

OS：Windows 10 x64

编译器：g++ std=c++11

CPU：Intel Core i7 10750H

内存：16GB RAM

### 实验设计与实现

总体流程：

​	1、提取表、列、条件；

​	2、执行select：对每个非Join的条件，筛选出每张表符合条件的记录的自然主键；

​	3、执行join：对上一步筛选出的每张表符合条件的记录的自然主键，做连接，得到自然主键tuples

​	4、执行project：根据最终的自然主键tuples，把需要查询的字段的值加到结果表里

实现了两种Join算法：Nested Join和Hash Join

数据暂存：用pair<string, void *>表示每个数据，前者指示类型名，后者指向数据本身所在的内存位置。处理过程尽量类型无关化，把依赖类型的操作放在最底层，此时用C++模板来处理

交和并：使用多路归并算法

### 使用手册

类SQL指令有如下格式：

第1行：一个整数n，表示涉及到的表的数量

接下来n行：每行一个字符串表示表名

接下来1行：一个整数m，表示涉及到的列的数量

接下来m行：每行两个字符串用空格隔开，表示某张的表的某个列

接下来1行：一个整数t，表示条件的数量

接下来t组，每组4行：

​	第1行：一个字符串表示条件的数据类型

​	第2行：1个数字0/1表示join或其他条件；1个字符串表示左边的表名（若左边是常数则和右边写一样的）；1个字符串表示左边的列名（若左边是常数写NO）；1个字符串或数字表示左边的常数值（若左边是列写0或NO）。

​	第3行：类似第2行，表示右边的情形

​	第4行：一个比较运算符

最后1行：AND或OR，表示条件用交还是并连接

### 测试方案

涉及nation、region和supplier表

若干条类SQL指令：包含选择、投影、多条件连接、不等条件连接、三表连接、笛卡尔积等，具体请见sql.txt。

### 结果

运行即可。

### 实验总结

掌握了多种算法的组合与复杂数据的处理。